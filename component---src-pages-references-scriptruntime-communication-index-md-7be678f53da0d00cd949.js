"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[1719],{37986:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return s},default:function(){return u}});var o,i=t(87462),r=t(63366),d=(t(15007),t(64983)),a=t(91515),m=["components"],s={},p=(o="InlineAlert",function(e){return console.warn("Component "+o+" was not imported, exported, or provided by MDXProvider as global scope"),(0,d.mdx)("div",e)}),c={_frontmatter:s},l=a.Z;function u(e){var n=e.components,t=(0,r.Z)(e,m);return(0,d.mdx)(l,(0,i.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,d.mdx)("h1",{id:"communication-apis"},"Communication APIs"),(0,d.mdx)("p",null,"The communication APIs allow you to communicate between the script runtime and the iframe where your add-on is running."),(0,d.mdx)("h2",{id:"overview"},"Overview"),(0,d.mdx)("p",null,"The script runtime and iframe runtime are two different runtime execution environments which are present on different threads in the browser. The communication APIs are based on the ",(0,d.mdx)("a",{parentName:"p",href:"https://github.com/GoogleChromeLabs/comlink"},"Comlink library")," and provide a mechanism to allow the JavaScript code executing in each to interact. Developers can call the apis exposed in one environment (ie: script runtime) from another environment (ie: iframe where their add-on is running) bidirectionally."),(0,d.mdx)("h2",{id:"accessing-the-apis"},"Accessing the APIs"),(0,d.mdx)("p",null,"An exported module named ",(0,d.mdx)("inlineCode",{parentName:"p"},"AddOnSdkApi")," is provided to enable the communication between the iframe and the script runtime via its' ",(0,d.mdx)("inlineCode",{parentName:"p"},"instance.runtime")," object. You can simply import it into your script file code for use and create a reference to the ",(0,d.mdx)("inlineCode",{parentName:"p"},"runtime")," object. For example:"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import { AddOnSdkApi } from "AddOnSdkApi"; // named import is AddOnSdkApi\n\nconst { runtime } = AddOnSdkApi.instance; // runtime object provides direct access to the comm methods\n')),(0,d.mdx)("h2",{id:"examples"},"Examples"),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"runtime")," object provides the methods to allow you to communicate between the two execution environments via ",(0,d.mdx)("inlineCode",{parentName:"p"},"exposeApi()")," and ",(0,d.mdx)("inlineCode",{parentName:"p"},"apiProxy()"),". The examples below show the methods in use from both the ",(0,d.mdx)("inlineCode",{parentName:"p"},"index.html")," where the iframe is running with your add-on code, and the script runtime environment running the contents of ",(0,d.mdx)("inlineCode",{parentName:"p"},"code.js"),"."),(0,d.mdx)("h3",{id:"expose-apis-from-the-script"},"Expose APIs from the script"),(0,d.mdx)("p",null,"This example shows how to expose APIs from the script runtime (via ",(0,d.mdx)("inlineCode",{parentName:"p"},"code.js"),") for use by the UI (via ",(0,d.mdx)("inlineCode",{parentName:"p"},"index.html"),")."),(0,d.mdx)("h4",{id:"codejs"},(0,d.mdx)("inlineCode",{parentName:"h4"},"code.js")),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import { AddOnSdkApi } from "AddOnSdkApi";\nconst { runtime } = AddOnSdkApi.instance;\n\nconst scriptApis = {\n    performWorkOnDocument: function (data, someFlag) {\n        // call the Editor APIs\n    },\n    getDataFromDocument: function() {\n        // get some data from document\n    }\n}\n// expose these apis to be directly consumed in the UI (ie: index.html file).\nruntime.exposeApi(scriptApis);\n')),(0,d.mdx)("h4",{id:"indexhtml"},"index.html"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import AddOnSdk from "https://new.express.adobe.com/static/add-on-sdk/sdk.js";\n\nAddOnSdk.ready.then(async () => {\n    const { runtime } = AddOnSdk.instance;\n\n    // Wait for the promise to resolve (the script runtime may not have initialized yet) to get a proxy to call APIs defined in the script\n    const scriptApis = await runtime.apiProxy("script");\n\n    await scriptApis.performWorkOnDocument({\n        pageNumber: 1,\n        op: "change_background_color",\n        data: {\n            toColor: "blue"\n        }\n    }, true);\n\n    console.log(await scriptApis.getDataFromDocument());\n});\n')),(0,d.mdx)("h3",{id:"expose-apis-from-the-ui"},"Expose APIs from the UI"),(0,d.mdx)("p",null,"This example shows how to expose APIs from the UI (via ",(0,d.mdx)("inlineCode",{parentName:"p"},"index.html"),") for use by the script runtime (via ",(0,d.mdx)("inlineCode",{parentName:"p"},"code.js"),")."),(0,d.mdx)("h4",{id:"indexhtml-1"},(0,d.mdx)("inlineCode",{parentName:"h4"},"index.html")),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'AddOnSdk.ready.then(async () => {\n    console.log("AddOnSdk is ready for use.");\n\n    const { runtime } = AddOnSdk.instance;\n    const uiApi = {\n        performWorkOnUI: function(data, someFlag) {\n            // Do some ui operation\n        },\n        getDataFromUI: async function() {\n            let resolver = undefined;\n            const promise = new Promise(resolve => {\n                resolver = resolve;\n            });\n            setTimeout(() => {\n                resolver("button_color_blue");\n            }, 10);\n            return await promise;\n        }\n    }\n    // Expose the UI Apis to be used in the script code (ie: code.js)\n    runtime.exposeApi(uiApi);\n}\n')),(0,d.mdx)("h4",{id:"codejs-1"},(0,d.mdx)("inlineCode",{parentName:"h4"},"code.js")),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import { AddOnSdkApi } from "AddOnSdkApi";\nconst { runtime } = AddOnSdkApi.instance;\n\nasync function callUIApis() {\n    // Get a proxy to the APIs defined in the UI\n    const uiApis = await runtime.apiProxy("panel");\n    await uiApis.performWorkOnUI({\n        buttonTextFont: 20,\n        buttonColor: "Green"\n    }, true);\n\n    const result = await uiApis.getDataFromUI();\n    console.log("Data from UI: " + result);\n}\n')),(0,d.mdx)(p,{slots:"text",variant:"info",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,(0,d.mdx)("strong",{parentName:"p"},"DEBUGGING:")," Since the script code runs in a separate context from your add-on UI, the only support for debugging is via the ",(0,d.mdx)("inlineCode",{parentName:"p"},"console.*")," methods."))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-references-scriptruntime-communication-index-md-7be678f53da0d00cd949.js.map
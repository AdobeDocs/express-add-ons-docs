"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[465],{30387:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return r},default:function(){return x}});var n=a(58168),o=a(80045),d=(a(88763),a(15680)),s=a(83407);const i=["components"],r={},m=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,d.mdx)("div",t)},p=m("ListBlock"),l=m("CodeBlock"),c=m("InlineAlert"),h={_frontmatter:r},u=s.A;function x(e){let{components:t}=e,a=(0,o.A)(e,i);return(0,d.mdx)(u,(0,n.A)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,d.mdx)("h1",{id:"creating-a-document-stats-add-on-with-the-adobe-express-communication-api"},"Creating a Document Stats add-on with the Adobe Express Communication API"),(0,d.mdx)("p",null,"In this tutorial, we'll build an Adobe Express add-on that gathers statistics on the active document using the Communication API."),(0,d.mdx)("h2",{id:"introduction"},"Introduction"),(0,d.mdx)("p",null,"Hello, and welcome to this Adobe Express Communication API tutorial, where we'll build together a ",(0,d.mdx)("strong",{parentName:"p"},"fully functional Stats add-on")," from scratch. This add-on will retrieve metadata from the currently open Adobe Express document, such as pages and their size, plus information about the kind and number of any element used."),(0,d.mdx)("p",null,(0,d.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,d.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"58.4375%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,d.mdx)("picture",{parentName:"span"},"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/5530d/stats-addon.webp 320w","/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/0c8fb/stats-addon.webp 640w","/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/94b1e/stats-addon.webp 1280w","/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/0b34d/stats-addon.webp 1920w","/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/9df40/stats-addon.webp 2218w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/dd4a7/stats-addon.png 320w","/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/0f09e/stats-addon.png 640w","/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/bbbf7/stats-addon.png 1280w","/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/ac7a9/stats-addon.png 1920w","/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/40851/stats-addon.png 2218w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,d.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/express-add-ons-docs/static/7aab0ee44dcf95632a5fc076a9219302/bbbf7/stats-addon.png",alt:"stats addon",title:"stats addon",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,d.mdx)("h3",{id:"timestamp"},"Timestamp"),(0,d.mdx)("p",null,"This tutorial has been written by Davide Barranca, software developer and author from Italy. It's been first published on December 14th, 2023."),(0,d.mdx)("h3",{id:"prerequisites"},"Prerequisites"),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},"Familiarity with HTML, CSS, JavaScript."),(0,d.mdx)("li",{parentName:"ul"},"Familiarity with the Adobe Express add-ons environment; if you need a refresher, follow the ",(0,d.mdx)("a",{parentName:"li",href:"../../../getting_started/hello-world.md"},"quickstart")," guide."),(0,d.mdx)("li",{parentName:"ul"},"Familiarity with the Adobe Express Document API, covered in ",(0,d.mdx)("a",{parentName:"li",href:"../tutorials/grids-addon.md"},"this tutorial"),"."),(0,d.mdx)("li",{parentName:"ul"},"An Adobe Express account; use your existing Adobe ID or create one for free."),(0,d.mdx)("li",{parentName:"ul"},"Node.js version 16 or newer.")),(0,d.mdx)("h3",{id:"topics-covered"},"Topics Covered"),(0,d.mdx)(p,{slots:"text1, text2",repeat:"2",iconColor:"#2ac3a2",icon:"disc",variant:"fullWidth",mdxType:"ListBlock"}),(0,d.mdx)("p",null,(0,d.mdx)("a",{parentName:"p",href:"#proxy-api"},"Invoking Document Model Sandbox methods from the UI iframe")),(0,d.mdx)("p",null,(0,d.mdx)("a",{parentName:"p",href:"#logic"},"Invoking UI iframe methods from the Document Model Sandbox")),(0,d.mdx)("p",null,(0,d.mdx)("a",{parentName:"p",href:"#proxy-api"},"Proxy API")),(0,d.mdx)("p",null,(0,d.mdx)("a",{parentName:"p",href:"#functions"},"Context Closures")),(0,d.mdx)("p",null,(0,d.mdx)("img",{parentName:"p",src:"/express-add-ons-docs/assets/0bd437229c8ac38756f7e599371074bd/stats-addon-animation.gif",alt:null})),(0,d.mdx)("h2",{id:"getting-started-with-the-communication-api"},"Getting Started with the Communication API"),(0,d.mdx)("p",null,"As we've seen in the previous Adobe Express ",(0,d.mdx)("a",{parentName:"p",href:"grids-addon.md"},"Document API tutorial"),", add-ons belong to the ",(0,d.mdx)("strong",{parentName:"p"},"UI iframe"),": a sandboxed environment subject to ",(0,d.mdx)("a",{parentName:"p",href:"../../platform_concepts/context.md#cors"},"CORS policies"),", where the User Interface (UI) and the add-on logic are built. The iframe itself has limited editing capabilities, though: via the ",(0,d.mdx)("inlineCode",{parentName:"p"},"addOnUISdk")," module, it can invoke a few methods to import media (image, video, and audio) and export the document into a number of formats, like ",(0,d.mdx)("inlineCode",{parentName:"p"},".pdf"),", ",(0,d.mdx)("inlineCode",{parentName:"p"},".mp4")," or ",(0,d.mdx)("inlineCode",{parentName:"p"},".jpg")," for example."),(0,d.mdx)("p",null,"The ",(0,d.mdx)("strong",{parentName:"p"},"Document API")," makes new, more powerful capabilities available, allowing the add-on to manipulate elements directly—like scripting in Desktop applications such as Photoshop or InDesign. This API is one component of the Document Sandbox, a JavaScript execution environment that also includes a restricted set of Web API (mostly debugging aids) as well as the means for the UI iframe and the Document API to exchange messages—the Communication API. This infrastructure is paramount as it bridges the gap between the two environments, allowing them to create a seamless experience."),(0,d.mdx)("h3",{id:"proxies"},"Proxies"),(0,d.mdx)("p",null,"How does this all work, then? The process involves exposing proxies for the ",(0,d.mdx)("em",{parentName:"p"},"other context")," to use, serving as a user-friendly abstraction; under the hood, the implementation relies on a messaging system, which is hidden to us developers."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'// runtime in the UI iframe\nimport addOnUISdk from "https://express.adobe.com/static/add-on-sdk/sdk.js";\nconst { runtime } = addOnUISdk.instance;\n\n// runtime in the Document Sandbox\nimport addOnSandboxSdk from "add-on-sdk-document-sandbox";\nconst { runtime } = addOnSandboxSdk.instance;\n')),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"runtime")," object uses the ",(0,d.mdx)("inlineCode",{parentName:"p"},"exposeApi()"),"to make content available to the other context—it works the same, regardless of whether the subject is the iframe or the Document Sandbox."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},"// 👇 both in the UI frame and the Document Sandbox\nruntime.exposeApi({\n  /* ... */\n}); // exposing a payload {}\n")),(0,d.mdx)("p",null,"We'll get to the details of such a payload in a short while; for the moment, think about it as a collection of methods acting on their environment (UI iframe or Document Sandbox). There needs to be more than exposing, though: some action is required ",(0,d.mdx)("em",{parentName:"p"},"on the other side")," to surface such a payload—it involves using the ",(0,d.mdx)("inlineCode",{parentName:"p"},"apiProxy()")," method documented ",(0,d.mdx)("a",{parentName:"p",href:"/express-add-ons-docs/references/addonsdk/instance-runtime/"},"here"),"."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'// UI iframe, importing a payload from the Document Sandbox\nconst sandboxProxy = await runtime.apiProxy("documentSandbox");\n\n// Document Sandbox, importing a payload from the UI iframe\nconst panelUIProxy = await runtime.apiProxy("panel");\n')),(0,d.mdx)("p",null,"At this point, ",(0,d.mdx)("inlineCode",{parentName:"p"},"sandboxProxy")," and ",(0,d.mdx)("inlineCode",{parentName:"p"},"panelUIProxy")," represent their counterparts from the original contexts. It all may be easier to understand when the entire process is written down; for example, in the following code, we expose a custom method called ",(0,d.mdx)("inlineCode",{parentName:"p"},"ready()")," defined in the UI iframe to the Document API."),(0,d.mdx)(l,{slots:"heading, code",repeat:"2",languages:"UI iframe, Document Sandbox",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"ui-iframe"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnUISdk from "https://express.adobe.com/static/add-on-sdk/sdk.js";\nconst { runtime } = addOnUISdk.instance;\n\n// exporting a payload to the Document Sandbox\nruntime.exposeApi({\n  ready: (env) => {\n    console.log(`The ${env} environment is ready`);\n  },\n});\n')),(0,d.mdx)("h4",{id:"document-sandbox"},"Document Sandbox"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnSandboxSdk from "add-on-sdk-document-sandbox";\nconst { runtime } = addOnSandboxSdk.instance;\n\n// importing from the iframe\nconst panelUIProxy = await runtime.apiProxy("panel");\n\n// We can call this method now\nawait panelUIProxy.ready("Document Sandbox");\n')),(0,d.mdx)("p",null,"As the name implies, the ",(0,d.mdx)("inlineCode",{parentName:"p"},"panelUIProxy")," constant in the Document Sandbox is a ",(0,d.mdx)("em",{parentName:"p"},"proxy")," for the object exposed by the iframe's runtime. The other way around works the same: exposing a Document API method to the iframe."),(0,d.mdx)(l,{slots:"heading, code",repeat:"2",languages:"iframe, Document Sandbox",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"ui-iframe-1"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnUISdk from "https://express.adobe.com/static/add-on-sdk/sdk.js";\nconst { runtime } = addOnUISdk.instance;\n\n// importing from the Document Sandbox\nconst sandboxProxy = await runtime.apiProxy("documentSandbox");\n\n// We can call this method now\nawait sandboxProxy.drawRect();\n')),(0,d.mdx)("h4",{id:"document-sandbox-1"},"Document Sandbox"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnSandboxSdk from "add-on-sdk-document-sandbox";\nconst { runtime } = addOnSandboxSdk.instance;\n\n// exporting a payload to the iframe\nruntime.exposeApi({\n  drawRect: () => {\n    // uss the Document API to draw a Rectangle shape...\n  },\n});\n')),(0,d.mdx)("p",null,"The following diagram helps visualize the process."),(0,d.mdx)("p",null,(0,d.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,d.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"59.06250000000001%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,d.mdx)("picture",{parentName:"span"},"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/5530d/stats-addon-proxy.webp 320w","/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/0c8fb/stats-addon-proxy.webp 640w","/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/94b1e/stats-addon-proxy.webp 1280w","/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/0b34d/stats-addon-proxy.webp 1920w","/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/f3963/stats-addon-proxy.webp 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/dd4a7/stats-addon-proxy.png 320w","/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/0f09e/stats-addon-proxy.png 640w","/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/bbbf7/stats-addon-proxy.png 1280w","/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/ac7a9/stats-addon-proxy.png 1920w","/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/6482f/stats-addon-proxy.png 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,d.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/express-add-ons-docs/static/8293cd87615a6599e4e56d9dd4d8c07b/bbbf7/stats-addon-proxy.png",alt:"Proxy objects",title:"Proxy objects",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,d.mdx)("h3",{id:"proxy-api"},"Proxy API"),(0,d.mdx)("p",null,"Now that we've seen how contexts expose and import each other's API, let's discuss what's inside the payload objects that cross this environment boundary."),(0,d.mdx)("h4",{id:"functions"},"Functions"),(0,d.mdx)("p",null,"Most of the time, you're going to expose ",(0,d.mdx)("strong",{parentName:"p"},"functions"),"."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},"// Document Sandbox\nruntime.exposeApi({\n  drawRect: () => {\n    /* ... */\n  }, // 👈\n  drawEllipse: () => {\n    /* ... */\n  }, // 👈\n  drawShape: () => {\n    /* ... */\n  }, // 👈\n  // etc.\n});\n")),(0,d.mdx)("p",null,"In the above example, if ",(0,d.mdx)("inlineCode",{parentName:"p"},"drawShape()")," needs to call either ",(0,d.mdx)("inlineCode",{parentName:"p"},"drawEllipse()")," or ",(0,d.mdx)("inlineCode",{parentName:"p"},"drawRect()"),", you may use the ",(0,d.mdx)("em",{parentName:"p"},"method shorthand syntax"),"."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},"// Document Sandbox\nruntime.exposeApi({\n  drawRect() {\n    /* ... */\n  }, // 👈\n  drawEllipse() {\n    /* ... */\n  }, // 👈\n  drawShape() {\n    this.drawRect(); // 👆\n    // or\n    this.drawEllipse(); // 👆\n  },\n  // etc.\n});\n")),(0,d.mdx)("p",null,"When not strictly necessary, keep functions private and expose only the ones needed."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},"// Document Sandbox\nconst drawRect = () => {\n  /* ... */\n}; // 👈 private\nconst drawEllipse = () => {\n  /* ... */\n}; // 👈 private\n\nruntime.exposeApi({\n  drawShape() {\n    drawRect(); // 👆\n    // or\n    drawEllipse(); // 👆\n  },\n});\n")),(0,d.mdx)("p",null,"Here, ",(0,d.mdx)("inlineCode",{parentName:"p"},"drawRect()")," and ",(0,d.mdx)("inlineCode",{parentName:"p"},"drawEllipse()")," exist within the closure of the ",(0,d.mdx)("inlineCode",{parentName:"p"},"drawShape()"),' function exposed to the iframe and will work just fine when the iframe invokes it. This notion of "private" variables defined in one context can be exploited in various ways, for instance, with a counter as follows.'),(0,d.mdx)(l,{slots:"heading, code",repeat:"2",languages:"iframe, Document Sandbox",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"ui-iframe-2"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'const sandboxProxy = await runtime.apiProxy("documentSandbox");\n\n// Calling the exposed method\nconst shapesNo = await sandboxProxy.drawShape();\nconsole.log("Shapes drawn", shapesNo);\n')),(0,d.mdx)("h4",{id:"document-sandbox-2"},"Document Sandbox"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'const drawRect = () => {\n  /* ... */\n};\nconst drawEllipse = () => {\n  /* ... */\n};\n\nlet counter = 0; // 👈 private to the sandbox\n\nruntime.exposeApi({\n  drawShape() {\n    if (counter >= 10) {\n      throw new Error("Shape\'s budget depleted!");\n    }\n    // Randomly draw either a rectangle or an ellipse\n    Math.random() < 0.5 ? drawRect() : drawEllipse();\n\n    return ++counter; // 👆\n  },\n});\n')),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"counter")," variable in the Document Sandbox is maintained between iframe calls within the same user session. It remains isolated to the specific document and cannot be shared with other open documents or users. However, it can be accessed by the ",(0,d.mdx)("inlineCode",{parentName:"p"},"drawShape()")," function. In this context, it's returned to provide the iframe with the count of shapes created up to that point. This introduces us to the notion of ",(0,d.mdx)("strong",{parentName:"p"},"returned values"),"."),(0,d.mdx)("p",null,"Generally speaking, you should restrict your returns to the following types."),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},"✅ Primitive values."),(0,d.mdx)("li",{parentName:"ul"},"✅ Object literals."),(0,d.mdx)("li",{parentName:"ul"},"✅ JSON strings."),(0,d.mdx)("li",{parentName:"ul"},"✅ ArrayBuffers and Blobs."),(0,d.mdx)("li",{parentName:"ul"},"✅ Promises.")),(0,d.mdx)("p",null,"The following returns won't work as expected and must be avoided."),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},"❌ Classes (constructor functions)."),(0,d.mdx)("li",{parentName:"ul"},"❌ Class instances (will get serialized and stripped away from any method)."),(0,d.mdx)("li",{parentName:"ul"},"❌ Functions."),(0,d.mdx)("li",{parentName:"ul"},"❌ Proxies."),(0,d.mdx)("li",{parentName:"ul"},"❌ Constructs such as ",(0,d.mdx)("inlineCode",{parentName:"li"},"Maps")," and ",(0,d.mdx)("inlineCode",{parentName:"li"},"Sets")," won't get through either, nor will ",(0,d.mdx)("inlineCode",{parentName:"li"},"Date")," and ",(0,d.mdx)("inlineCode",{parentName:"li"},"RegExp"),"."),(0,d.mdx)("li",{parentName:"ul"},"❌ ",(0,d.mdx)("inlineCode",{parentName:"li"},"new Error()"),", either thrown or returned, won't provide any error message (at the moment) when caught using a ",(0,d.mdx)("inlineCode",{parentName:"li"},"try"),"/",(0,d.mdx)("inlineCode",{parentName:"li"},"catch")," block.")),(0,d.mdx)("h4",{id:"primitives"},"Primitives"),(0,d.mdx)("p",null,"Nothing prevents you from using something else besides functions in your proxy. For instance, you can refactor the ",(0,d.mdx)("inlineCode",{parentName:"p"},"drawShape()")," example by exposing a ",(0,d.mdx)("inlineCode",{parentName:"p"},"counter")," property alongside its setter and getter."),(0,d.mdx)(l,{slots:"heading, code",repeat:"2",languages:"iframe, Document Sandbox",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"ui-iframe-3"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'// iframe\nconst sandboxProxy = await runtime.apiProxy("documentSandbox");\n\nfor (let i = 0; i < 10; i++) {\n  await sandboxProxy.drawShape();\n}\nsandboxProxy.counter = 0; // resetting the counter\nawait sandboxProxy.drawShape();\n')),(0,d.mdx)("h4",{id:"document-sandbox-3"},"Document Sandbox"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'// Document Sandbox\nconst drawRect    = () => { /* ... */ };\nconst drawEllipse = () => { /* ... */ };\n\nlet _counter = 0; 👈 // private member (mind the underscore)\n\nruntime.exposeApi({\n  drawShape() {\n    if (_counter >= 10) { // 👈 mind the underscore\n      throw new Error("Shape\'s budget depleted!");\n    }\n    // Randomly draw either a rectangle or an ellipse\n    Math.random() < 0.5 ? drawRect() : drawEllipse();\n    this.counter = this.counter + 1; // Use the setter to increment\n    return this.counter; // Return the new value after incrementing\n  },\n  get counter()    { return _counter; }, // 👈 getter\n  set counter(val) { _counter = val; }   // 👈 setter\n});\n')),(0,d.mdx)("p",null,"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"counter")," setter has the ability to perform additional actions, such as manipulating the document, in addition to assigning a new value to the private variable ",(0,d.mdx)("inlineCode",{parentName:"p"},"_counter"),"."),(0,d.mdx)("p",null,"Please note that, given the async nature of the Communication API, retrieving the ",(0,d.mdx)("inlineCode",{parentName:"p"},"counter")," value in the iframe requires the use of ",(0,d.mdx)("inlineCode",{parentName:"p"},"await")," or a ",(0,d.mdx)("inlineCode",{parentName:"p"},"then()")," callback."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},"let counter = await sandboxProxy.counter;\n// or\nsandboxProxy.counter.then((counter) => {\n  /* ... */\n});\n")),(0,d.mdx)("h3",{id:"asynchronous-communication"},"Asynchronous communication"),(0,d.mdx)("p",null,"The Communication API wraps all inter-context function invocations with a ",(0,d.mdx)("strong",{parentName:"p"},"Promise"),". In other words, regardless of the nature of the function called, when it gets from one context to the other (from the iframe to the Document Sandbox or vice-versa), it must be dealt with as if it were ",(0,d.mdx)("strong",{parentName:"p"},"asynchronous"),"."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},"// Document Sandbox\nruntime.exposeApi({\n  drawShape() { /* ... */ } // 👈 Document API methods are typically *synchronous*\n});\n\n// iframe\n❌ const res = sandboxProxy.drawShape(); // 👀 no await, returns a Promise\n❌ console.log(res instanceof Promise);  // true\n\n✅ const res = await sandboxProxy.drawShape(); // using await\n✅ console.log(typeof res); // number (it returns the counter, as you remember)\n")),(0,d.mdx)("h2",{id:"coding-the-stats-add-on"},"Coding the Stats add-on"),(0,d.mdx)("p",null,"You are now equipped with all the theory and reference snippets needed to start building the Stats add-on: it's a simple project implementing the Communication API in a couple of different ways. Feature-wise, it's split into two parts."),(0,d.mdx)("ol",null,(0,d.mdx)("li",{parentName:"ol"},"The add-on shows two ",(0,d.mdx)("strong",{parentName:"li"},"status lights")," that indicate whether the SDKs are ready for use."),(0,d.mdx)("li",{parentName:"ol"},"At the press of a button, the add-on (via Document API) collects the document's metadata",(0,d.mdx)("sup",{parentName:"li",id:"fnref-0"},(0,d.mdx)("a",{parentName:"sup",href:"#fn-0",className:"footnote-ref"},"0")),", which is used to compile and show a ",(0,d.mdx)("strong",{parentName:"li"},"table of Nodes")," (elements).")),(0,d.mdx)("p",null,(0,d.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,d.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"51.5625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,d.mdx)("picture",{parentName:"span"},"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/5530d/stats-addon-vscode.webp 320w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/0c8fb/stats-addon-vscode.webp 640w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/94b1e/stats-addon-vscode.webp 1280w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/0b34d/stats-addon-vscode.webp 1920w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/d5269/stats-addon-vscode.webp 2560w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/d44a4/stats-addon-vscode.webp 2706w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/dd4a7/stats-addon-vscode.png 320w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/0f09e/stats-addon-vscode.png 640w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/bbbf7/stats-addon-vscode.png 1280w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/ac7a9/stats-addon-vscode.png 1920w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/c7a69/stats-addon-vscode.png 2560w","/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/2e2a9/stats-addon-vscode.png 2706w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,d.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/express-add-ons-docs/static/4202a1e06beb29f84415e2d944edf238/bbbf7/stats-addon-vscode.png",alt:"stats addon vscode",title:"stats addon vscode",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,d.mdx)("p",null,"Like in the ",(0,d.mdx)("a",{parentName:"p",href:"grids-addon.md"},"Grids add-on tutorial"),", the starting point will be ",(0,d.mdx)("a",{parentName:"p",href:"https://github.com/AdobeDocs/express-add-on-samples/tree/main/document-sandbox-samples/express-addon-document-api-template"},"this template"),", which provides a Webpack-managed JavaScript—hence, able to easily import Spectrum Web Components to build the User Interface. Everything's in the ",(0,d.mdx)("inlineCode",{parentName:"p"},"src")," folder:"),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"index.html")," is where the iframe's UI is built."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"ui/index.js")," deals with the add-on's internal logic."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"ui/table-utils.js")," contains table-related functions consumed by the iframe and imported by ",(0,d.mdx)("inlineCode",{parentName:"li"},"index.js")," to keep it slim."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"documentSandbox/code.js")," contains the Document API methods exposed to the iframe."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"documentSandbox/utils.js")," stores Document API private functions imported in ",(0,d.mdx)("inlineCode",{parentName:"li"},"code.js"),".")),(0,d.mdx)("h3",{id:"user-interface"},"User Interface"),(0,d.mdx)("p",null,"To keep a consistent look & feel with the rest of the application, we'll use Spectrum Web Component as much as possible, styling them with the ",(0,d.mdx)("inlineCode",{parentName:"p"},"express")," theme provided by the ",(0,d.mdx)("inlineCode",{parentName:"p"},"<sp-theme>")," wrapper."),(0,d.mdx)("p",null,(0,d.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,d.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"62.5%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,d.mdx)("picture",{parentName:"span"},"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/5530d/stats-addon-doc.webp 320w","/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/0c8fb/stats-addon-doc.webp 640w","/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/94b1e/stats-addon-doc.webp 1280w","/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/0b34d/stats-addon-doc.webp 1920w","/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/f3963/stats-addon-doc.webp 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/dd4a7/stats-addon-doc.png 320w","/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/0f09e/stats-addon-doc.png 640w","/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/bbbf7/stats-addon-doc.png 1280w","/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/ac7a9/stats-addon-doc.png 1920w","/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/6482f/stats-addon-doc.png 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,d.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/express-add-ons-docs/static/0774237689c842565fb91f04299b80b2/bbbf7/stats-addon-doc.png",alt:"stats addon doc",title:"stats addon doc",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,d.mdx)("p",null,'For the "Framework Status", the ',(0,d.mdx)("a",{parentName:"p",href:"https://opensource.adobe.com/spectrum-web-components/components/status-light/"},"Status Light")," component is spot-on: it comes in many variants, which set different light colors—",(0,d.mdx)("inlineCode",{parentName:"p"},"positive")," and ",(0,d.mdx)("inlineCode",{parentName:"p"},"negative"),' (green 🟢 and red 🔴) will be enough for us. The "Document Statistics" section is going to show a list of key/value pairs (the element type and the number of items found on each page). The most obvious choice is a ',(0,d.mdx)("a",{parentName:"p",href:"https://opensource.adobe.com/spectrum-web-components/components/table/"},"Table")," component, which in SWC is constructed with several tags."),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table>")," is the outer wrapper."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table-head>")," and ",(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table-head-cell>")," set the header."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table-body>")," is for the body, which contains ",(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table-row>")," and ",(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table-cell>")," elements.")),(0,d.mdx)("p",null,"We'll start with a placeholder row with a friendly message, which is going to be removed at the first launch. A regular ",(0,d.mdx)("inlineCode",{parentName:"p"},"<sp-button>")," is placed at the bottom to initiate the metadata-collecting process."),(0,d.mdx)(l,{slots:"heading, code",repeat:"1",languages:"index.html",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"indexhtml"},"index.html"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-html"},'<body>\n  <sp-theme\n    scale="medium"\n    color="light"\n    theme="express"\n  >\n    <h3>Framework status</h3>\n    <hr />\n    <div class="row">\n      <sp-status-light\n        size="m"\n        variant="negative"\n        id="iframe-status"\n      >\n        iFrame API\n      </sp-status-light>\n      <sp-status-light\n        size="m"\n        variant="negative"\n        id="document-status"\n      >\n        Authoring API\n      </sp-status-light>\n    </div>\n    <h3>Document statistics</h3>\n    <hr />\n    <div class="row">\n      <sp-table size="m">\n        <sp-table-head>\n          <sp-table-head-cell>Element</sp-table-head-cell>\n          <sp-table-head-cell>Count</sp-table-head-cell>\n        </sp-table-head>\n        <sp-table-body id="stats-table-body">\n          <sp-table-row id="row-placeholder">\n            <sp-table-cell>Get the Document stats first...</sp-table-cell>\n          </sp-table-row>\n        </sp-table-body>\n      </sp-table>\n    </div>\n    <div class="row align-right">\n      <sp-button id="stats">Analyze document</sp-button>\n    </div>\n  </sp-theme>\n</body>\n')),(0,d.mdx)("h3",{id:"logic"},"Logic"),(0,d.mdx)("p",null,"The diagram below illustrates the communication flow between the two contexts."),(0,d.mdx)("p",null,(0,d.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,d.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"35.3125%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,d.mdx)("picture",{parentName:"span"},"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/5530d/stats-addon-flow.webp 320w","/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/0c8fb/stats-addon-flow.webp 640w","/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/94b1e/stats-addon-flow.webp 1280w","/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/0b34d/stats-addon-flow.webp 1920w","/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/f3963/stats-addon-flow.webp 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/dd4a7/stats-addon-flow.png 320w","/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/0f09e/stats-addon-flow.png 640w","/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/bbbf7/stats-addon-flow.png 1280w","/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/ac7a9/stats-addon-flow.png 1920w","/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/6482f/stats-addon-flow.png 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,d.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/express-add-ons-docs/static/ada8646adfcb9f5a6031b84de7858b1a/bbbf7/stats-addon-flow.png",alt:"stats addon flow",title:"stats addon flow",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,d.mdx)("p",null,"The iframe exposes two methods:"),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"toggleStatus()")," will be used independently by the iframe and the Document API to switch the Framework Status lights to green when ready."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"createTable()")," expects to be passed the document metadata and deals with the ",(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table>")," setup.")),(0,d.mdx)("p",null,"The Document Sandbox exposes only a ",(0,d.mdx)("inlineCode",{parentName:"p"},"getDocumentData()")," method, which collects the metadata from the open document. Both contexts import each other's API via proxy."),(0,d.mdx)("p",null,"When the iframe has loaded its SDK, it will call ",(0,d.mdx)("inlineCode",{parentName:"p"},"toggleStatus()"),", passing the ",(0,d.mdx)("inlineCode",{parentName:"p"},'"iframe"')," string as a parameter—telling the function which light to turn green. Similarly, when the Document Sandbox is ready, it will reach out for ",(0,d.mdx)("inlineCode",{parentName:"p"},"toggleStatus()")," on its own. Neither process requires the user's intervention."),(0,d.mdx)("p",null,'When the "Analyze Document" button is clicked, the iframe—via the Document Sandbox proxy—invokes ',(0,d.mdx)("inlineCode",{parentName:"p"},"getDocumentData()"),". Instead of returning an object with the metadata to the iframe for further processing (which would be OK), ",(0,d.mdx)("strong",{parentName:"p"},"the Document API uses the iframe proxy to run directly")," ",(0,d.mdx)("inlineCode",{parentName:"p"},"createTable()")," and initiate the table subroutine in an ",(0,d.mdx)("em",{parentName:"p"},"iframe-to-Document-Sandbox-to-iframe")," roundtrip. Let's have a look at the overall structure in ",(0,d.mdx)("inlineCode",{parentName:"p"},"index.js")," implementing the logic I've just described."),(0,d.mdx)(l,{slots:"heading, code",repeat:"1",languages:"index.js",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"uiindexjs"},"ui/index.js"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'// SWC imports\nimport "@spectrum-web-components/styles/typography.css";\nimport "@spectrum-web-components/theme/src/themes.js";\nimport "@spectrum-web-components/theme/theme-light.js";\nimport "@spectrum-web-components/theme/express/theme-light.js";\nimport "@spectrum-web-components/theme/express/scale-medium.js";\nimport "@spectrum-web-components/theme/sp-theme.js";\n\nimport "@spectrum-web-components/status-light/sp-status-light.js";\nimport "@spectrum-web-components/table/elements.js";\nimport "@spectrum-web-components/button/sp-button.js";\n\nimport addOnUISdk from "https://express.adobe.com/static/add-on-sdk/sdk.js";\n\n// Wait until the addOnUISdk has been loaded\naddOnUISdk.ready.then(async () => {\n  // API to expose to the Document Sandbox\n  const iframeApi = {\n    createTable(documentData) {\n      /* ... */\n    },\n    toggleStatus(sdk) {\n      /* ... */\n    },\n  };\n  runtime.exposeApi(iframeApi);\n\n  // Toggle the iframe SDK status light\n  iframeApi.toggleStatus("iframe");\n\n  // Import the Document Sandbox API proxy\n  const { runtime } = addOnUISdk.instance;\n  const sandboxProxy = await runtime.apiProxy("documentSandbox");\n  // Exposing the iFrame API to the Document Sandbox.\n\n  // Set the button\'s click handler\n  const statsButton = document.getElementById("stats");\n  statsButton.addEventListener("click", async () => {\n    // Invoke the Document API via Document Sandbox proxy\n    // to get the document metadata and initiate the table creation process\n    await sandboxProxy.getDocumentData(); // 👈 mind the await\n  });\n\n  // Enable the button only when the addOnUISdk is ready\n  statsButton.disabled = false;\n});\n')),(0,d.mdx)("p",null,"Besides the usual SWC imports, everything must be wrapped by a callback invoked when the ",(0,d.mdx)("inlineCode",{parentName:"p"},"addOnUISdk")," module is ",(0,d.mdx)("inlineCode",{parentName:"p"},"ready"),"—which also means we can switch the first SDK status light to green. Please note that ",(0,d.mdx)("inlineCode",{parentName:"p"},"toggleStatus()")," must be available to both the iframe and the Document Sandbox: declaring the ",(0,d.mdx)("inlineCode",{parentName:"p"},"iframeApi")," constant first (lines 18-21) and passing it to ",(0,d.mdx)("inlineCode",{parentName:"p"},"exposeApi()")," later allows me to call it (line 21)."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'// ❌ _in this case_ it\'s the wrong syntax choice!\nruntime.exposeApi({\n  createTable(documentData) { /* ... */ },\n  toggleStatus(sdk) { /* ... */ }\n});\n\n// ✅ better for our needs _in this context_\nconst iframeApi = {\n  createTable(documentData) { /* ... */ },\n  toggleStatus(sdk) { /* ... */ }\n});\nruntime.exposeApi(iframeApi);\n// toggleStatus is accessible in the iframe too\niframeApi.toggleStatus("iframe"); // 👈\n')),(0,d.mdx)(c,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"Let me remind you again of the need to ",(0,d.mdx)("inlineCode",{parentName:"p"},"await")," when invoking ",(0,d.mdx)("inlineCode",{parentName:"p"},"getDocumentData()")," (line 37, ",(0,d.mdx)("inlineCode",{parentName:"p"},"index.js"),"), as the Communication API wraps proxy calls with Promises."),(0,d.mdx)("p",null,"In ",(0,d.mdx)("inlineCode",{parentName:"p"},"documentSandbox/code.js"),", we bring the iframe proxy in, toggle the status light, and expose the ",(0,d.mdx)("inlineCode",{parentName:"p"},"getDocumentData()")," function. Please note that it must be declared asynchronous (line 7) because of the need to ",(0,d.mdx)("inlineCode",{parentName:"p"},"await")," when invoking the ",(0,d.mdx)("inlineCode",{parentName:"p"},"panelUIProxy")," method ",(0,d.mdx)("inlineCode",{parentName:"p"},"createTable()")," (line 12)."),(0,d.mdx)(l,{slots:"heading, code",repeat:"1",languages:"code.js",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"documentsandboxcodejs"},"documentSandbox/code.js"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnSandboxSdk from "add-on-sdk-document-sandbox";\nconst { runtime } = addOnSandboxSdk.instance;\n\nasync function start() {\n  const panelUIProxy = await runtime.apiProxy("panel");\n  runtime.exposeApi({\n    async getDocumentData() {\n      // 👈 async keyword, because 👇\n      // Get the document\'s metadata\n      let documentData;\n      // ... TODO\n      // ... then, directly invoke the iframe method\n      await panelUIProxy.createTable(documentData); // 👈 the Communication API is async 👆\n    },\n  });\n  // switch the Framework Status light to green\n  panelUIProxy.toggleStatus("document");\n}\nstart();\n')),(0,d.mdx)(c,{variant:"info",slots:"text, text1, text2",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"Please note that it would be perfectly fine to return the ",(0,d.mdx)("inlineCode",{parentName:"p"},"documentData")," object to the iframe and let it invoke ",(0,d.mdx)("inlineCode",{parentName:"p"},"createTable()"),' on its own. I\'ve chosen to do it this way to show you how that this sort of "circular" communication is possible—although the other approach is perhaps more common.'),(0,d.mdx)("p",null,"Speaking of coding style in the way the proxy is exposed, you may find more readable to implement the functions elsewhere (either in the same file or in a separate module) and use the object property shorthand syntax."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},"const getDocumentData = async () => {\n  /* ... */\n};\n// ...\nruntime.exposeApi({\n  getDocumentData, // 👈 shorthand syntax\n  // ...\n});\n")),(0,d.mdx)("h3",{id:"implementation"},"Implementation"),(0,d.mdx)("p",null,"Let's start filling in the missing parts in our code; we'll begin with the Framework Status, the easiest bit. The ",(0,d.mdx)("inlineCode",{parentName:"p"},"toggleStatus()")," method is immediately invoked in the ",(0,d.mdx)("inlineCode",{parentName:"p"},"addOnUISdk.ready")," callback, as well as the Document Sandbox ",(0,d.mdx)("inlineCode",{parentName:"p"},"code.js"),", where it is also exposed. It updates the ",(0,d.mdx)("inlineCode",{parentName:"p"},"variant")," attribute of the ",(0,d.mdx)("inlineCode",{parentName:"p"},"<sp-status-light>")," element based on the ",(0,d.mdx)("inlineCode",{parentName:"p"},"sdk")," parameter passed in."),(0,d.mdx)(l,{slots:"heading, code",repeat:"2",languages:"iframe, Document Sandbox",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"ui-iframe-4"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'const iframeApi = {\n  toggleStatus(sdk) {\n    // sdk parameter validation\n    if (["document", "iframe"].indexOf(sdk) === -1) {\n      throw new Error("Invalid SDK type");\n    }\n    const el =\n      sdk === "document"\n        ? document.getElementById("document-status")\n        : document.getElementById("iframe-status");\n    el.setAttribute("variant", "positive"); // 🟢\n  },\n  // ...\n};\n\niframeApi.toggleStatus("iframe"); // 👈\n')),(0,d.mdx)("h4",{id:"document-sandbox-4"},"Document Sandbox"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnSandboxSdk from "add-on-sdk-document-sandbox";\nconst { runtime } = addOnSandboxSdk.instance;\n\nasync function start() {\n  const panelUIProxy = await runtime.apiProxy("panel");\n  // ...\n  panelUIProxy.toggleStatus("document"); // 👈\n}\nstart();\n')),(0,d.mdx)("p",null,"When refreshing the add-on, the UI updates almost instantly, but a frame-by-frame analysis would reveal a progression in the rendering process: first, the HTML is loaded, then the CSS with the ",(0,d.mdx)("inlineCode",{parentName:"p"},"<sp-status-light>"),' components in their original, "red" variant; finally, when the two SDK are fully loaded, we get the green lights.',(0,d.mdx)("sup",{parentName:"p",id:"fnref-1"},(0,d.mdx)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))),(0,d.mdx)("p",null,(0,d.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,d.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"29.375%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,d.mdx)("picture",{parentName:"span"},"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/5530d/stats-addon-lights.webp 320w","/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/0c8fb/stats-addon-lights.webp 640w","/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/94b1e/stats-addon-lights.webp 1280w","/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/0b34d/stats-addon-lights.webp 1920w","/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/f3963/stats-addon-lights.webp 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/dd4a7/stats-addon-lights.png 320w","/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/0f09e/stats-addon-lights.png 640w","/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/bbbf7/stats-addon-lights.png 1280w","/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/ac7a9/stats-addon-lights.png 1920w","/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/6482f/stats-addon-lights.png 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,d.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/express-add-ons-docs/static/e2bf382ae58e38fba1ef4ed17367c39b/bbbf7/stats-addon-lights.png",alt:"Status lights",title:"Status lights",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,d.mdx)("p",null,"Let's tackle the metadata collection in the Document Sandbox, especially the data structure we want to create",(0,d.mdx)("sup",{parentName:"p",id:"fnref-2"},(0,d.mdx)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2")),". There are many ways to go about this business: I've decided to keep track of elements on a Page basis and store page dimensions, too. Eventually, the iframe will receive ",(0,d.mdx)("inlineCode",{parentName:"p"},"documentData"),", an array of objects, one for each page, with ",(0,d.mdx)("inlineCode",{parentName:"p"},"dimensions")," and ",(0,d.mdx)("inlineCode",{parentName:"p"},"nodes")," properties. If you've got a taste for TypeScript, the type definition would be as follows."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-ts"},"type DocumentData = Array<{\n  dimensions: { width: number; height: number };\n  nodes: { [key: string]: number };\n}>;\n")),(0,d.mdx)("p",null,"The above would transpose into something along these lines."),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'[\n  {\n    // page 1\n    dimensions: { width: 1200, height: 1200 },\n    nodes: {\n      "ab:Artboard": 1,\n      MediaContainer: 1,\n      Text: 2,\n      ComplexShape: 3,\n    },\n  },\n  {\n    // page 2\n    dimensions: { width: 800, height: 400 },\n    nodes: {\n      "ab:Artboard": 1,\n      MediaContainer: 4,\n      Rectangle: 2,\n    },\n  },\n  // ...\n];\n')),(0,d.mdx)("p",null,"The various ",(0,d.mdx)("inlineCode",{parentName:"p"},'"ab:Artboard"'),", ",(0,d.mdx)("inlineCode",{parentName:"p"},'"MediaContainer"')," and others, are the Node type strings as Adobe Express exposes them. Let's create the ",(0,d.mdx)("inlineCode",{parentName:"p"},"getDocumentData()")," function that outputs such a structure."),(0,d.mdx)("p",null,(0,d.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,d.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"50.625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,d.mdx)("picture",{parentName:"span"},"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/5530d/stats-addon-type.webp 320w","/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/0c8fb/stats-addon-type.webp 640w","/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/94b1e/stats-addon-type.webp 1280w","/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/0b34d/stats-addon-type.webp 1920w","/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/d5269/stats-addon-type.webp 2560w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/dd4a7/stats-addon-type.png 320w","/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/0f09e/stats-addon-type.png 640w","/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/bbbf7/stats-addon-type.png 1280w","/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/ac7a9/stats-addon-type.png 1920w","/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/c7a69/stats-addon-type.png 2560w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,d.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/express-add-ons-docs/static/2ffba3474f2c90964a0bc31af2dd7053/bbbf7/stats-addon-type.png",alt:"stats addon type",title:"stats addon type",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,d.mdx)(l,{slots:"heading, code",repeat:"1",languages:"code.js",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"documentsandboxcodejs-1"},"documentSandbox/code.js"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import { getNodeData } from "./utils";\n\nruntime.exposeApi({\n  async getDocumentData() {\n    const doc = editor.documentRoot; // get the document\n    let documentData = []; // initialize the array to return\n    for (const page of doc.pages) {\n      // loop through each page\n      let pageData = {}; // create an empty object\n      pageData.dimensions = {\n        // get and store the page `dimensions`\n        width: page.width,\n        height: page.height,\n      };\n      pageData.nodes = getNodeData(page); // 👈 build the `nodes` object (more on this later)\n      documentData.push(pageData); // push the object to the documentData array\n    }\n    // invoke the iframe method to create the table on the UI\n    await panelUIProxy.createTable(documentData);\n  },\n});\n')),(0,d.mdx)("p",null,"The code comments will guide you through the process of getting the document, loop through pages extracting dimensions, and retrieving nodes metadata, but up to a point. What's ",(0,d.mdx)("inlineCode",{parentName:"p"},"getNodeData"),"? As I mentioned before, I've split the Document API code into two parts: the main Document Sandbox entrypoint (",(0,d.mdx)("inlineCode",{parentName:"p"},"code.js"),", where methods are exposed to and imported from the iframe) and ",(0,d.mdx)("inlineCode",{parentName:"p"},"table-utils.js"),", which is kept private to the context and exports just what ",(0,d.mdx)("inlineCode",{parentName:"p"},"code.js")," needs—the ",(0,d.mdx)("inlineCode",{parentName:"p"},"getNodeData()")," method, which makes use of ",(0,d.mdx)("inlineCode",{parentName:"p"},"increaseCount()"),"."),(0,d.mdx)(l,{slots:"heading, code",repeat:"1",languages:"utils.js",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"documentsandboxtable-utilsjs"},"documentSandbox/table-utils.js"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'const increaseCount = (obj, type) => {\n  // If the type is already in the object, increase its count, otherwise set it to 1\n  if (obj.hasOwnProperty(type)) {\n    obj[type] += 1;\n  } else {\n    obj[type] = 1;\n  }\n};\n\nconst getNodeData = (node, nodeData = {}) => {\n  if (node.type === "MediaContainer") {\n    return nodeData;\n  }\n\n  // Check if the current node has children and if they are not an empty array\n  if (node.allChildren && node.allChildren.length > 0) {\n    // Iterate over all children using for..of\n    for (const child of node.allChildren) {\n      // Increase the count for the current type\n      increaseCount(nodeData, child.type);\n\n      // Recursively call getNodeData for each child that has its own children\n      // ... unless it\'s a MediaContainer\n      if (\n        child.type !== "MediaContainer" &&\n        child.allChildren &&\n        child.allChildren.length > 0\n      ) {\n        getNodeData(child, nodeData);\n      }\n    }\n  }\n\n  return nodeData;\n};\n\nexport { getNodeData };\n')),(0,d.mdx)("p",null,"Given the nature of Adobe Express documents (which will be covered in detail in a future tutorial), it makes sense to build ",(0,d.mdx)("inlineCode",{parentName:"p"},"getNodeData()")," as a recursive function: a ",(0,d.mdx)("a",{parentName:"p",href:"/express-add-ons-docs/references/document-sandbox/document-apis/classes/PageNode/"},(0,d.mdx)("inlineCode",{parentName:"a"},"PageNode"))," can contain multiple ",(0,d.mdx)("a",{parentName:"p",href:"/express-add-ons-docs/references/document-sandbox/document-apis/classes/ArtboardNode/"},(0,d.mdx)("inlineCode",{parentName:"a"},"ArtboardNode"))," elements, which in turn can contain multiple ",(0,d.mdx)("a",{parentName:"p",href:"/express-add-ons-docs/references/document-sandbox/document-apis/classes/GroupNode/"},(0,d.mdx)("inlineCode",{parentName:"a"},"GroupNode"))," elements, and so on. As follows, the metacode."),(0,d.mdx)("ol",null,(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"getNodeData()")," method begins its execution when called by ",(0,d.mdx)("inlineCode",{parentName:"p"},"getDocumentData()"),", taking a single parameter named ",(0,d.mdx)("inlineCode",{parentName:"p"},"page"),". At the start, ",(0,d.mdx)("inlineCode",{parentName:"p"},"nodeData")," is initialized as an empty object. The method then checks if the current node has the ",(0,d.mdx)("inlineCode",{parentName:"p"},"allChildren")," property, which should be a non-empty iterable (please note: it's not an Array, but can be transformed into one if needed via ",(0,d.mdx)("inlineCode",{parentName:"p"},"Array.from()"),"). If so, it goes through it. During each iteration, it increments the count for the ",(0,d.mdx)("inlineCode",{parentName:"p"},"type")," property of each child node (such as ",(0,d.mdx)("inlineCode",{parentName:"p"},'"Text"'),", ",(0,d.mdx)("inlineCode",{parentName:"p"},'"Group"'),", etc.).")),(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"If a child node within this array also features a non-empty ",(0,d.mdx)("inlineCode",{parentName:"p"},"allChildren")," property, ",(0,d.mdx)("inlineCode",{parentName:"p"},"getNodeData()")," is called recursively on that child node. Mind you: during these recursive calls, ",(0,d.mdx)("inlineCode",{parentName:"p"},"nodeData")," is passed as the second argument. This approach ensures that the same ",(0,d.mdx)("inlineCode",{parentName:"p"},"nodeData")," object is continuously used throughout the recursion, allowing it to accumulate and keep tabs on all node types encountered across all hierarchy levels. The ",(0,d.mdx)("inlineCode",{parentName:"p"},'"MediaContainer"')," node is a particular one, ",(0,d.mdx)("sup",{parentName:"p",id:"fnref-3"},(0,d.mdx)("a",{parentName:"sup",href:"#fn-3",className:"footnote-ref"},"3"))," and when encountered, we stop there.")),(0,d.mdx)("li",{parentName:"ol"},(0,d.mdx)("p",{parentName:"li"},"The ",(0,d.mdx)("inlineCode",{parentName:"p"},"increaseCount()")," method, which we keep private to the ",(0,d.mdx)("inlineCode",{parentName:"p"},"utils.js")," module, receives the ",(0,d.mdx)("inlineCode",{parentName:"p"},"nodeData")," object and bumps the count for each ",(0,d.mdx)("inlineCode",{parentName:"p"},"child.type"),"."))),(0,d.mdx)("p",null,"When the whole process is repeated for each ",(0,d.mdx)("inlineCode",{parentName:"p"},"page"),", we can finally invoke the iframe ",(0,d.mdx)("inlineCode",{parentName:"p"},"createTable()")," method, passing the ",(0,d.mdx)("inlineCode",{parentName:"p"},"documentData"),"."),(0,d.mdx)(l,{slots:"heading, code",repeat:"1",languages:"code.js",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"documentsandboxcodejs-2"},"documentSandbox/code.js"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},"runtime.exposeApi({\n  async getDocumentData() {\n    // ... create and fill the `documentData` array\n    await panelUIProxy.createTable(documentData); // 👈 calling this iframe proxy method\n  },\n});\n")),(0,d.mdx)("p",null,"Now, it's up to the iframe to manage such data (the array of objects collecting page dimensions and node counts) and transform it into a Spectrum Table."),(0,d.mdx)(l,{slots:"heading, code",repeat:"1",languages:"index.js",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"uiindexjs-1"},"ui/index.js"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import { rebuildTable } from "./table-utils";\n\nconst iframeApi = {\n  toggleStatus(sdk) {\n    /* ... */\n  },\n  createTable(documentData) {\n    // 👈\n    const table = document.getElementById("stats-table-body");\n    rebuildTable(table, documentData);\n  },\n};\n')),(0,d.mdx)("p",null,"The process is not difficult per se, but it may be slightly tedious. The ",(0,d.mdx)("inlineCode",{parentName:"p"},"rebuildTable()")," method is declared in the ",(0,d.mdx)("inlineCode",{parentName:"p"},"table-utils.js")," module alongside a private ",(0,d.mdx)("inlineCode",{parentName:"p"},"addRowToTable()"),"."),(0,d.mdx)(l,{slots:"heading, code",repeat:"1",languages:"table-utils.js",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"documentsandboxtable-utilsjs-1"},"documentSandbox/table-utils.js"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'// documentSandbox/table-utils.js\n\nconst addRowToTable = (table, rowData) => {\n  // Create a new row\n  const newRow = document.createElement("sp-table-row");\n\n  // For each cell data, create a cell and append it to the row\n  let cell;\n  rowData.forEach((cellData) => {\n    cell = document.createElement("sp-table-cell");\n    cell.textContent = cellData;\n    newRow.appendChild(cell);\n  });\n  if (rowData.length === 1) {\n    // Making the page row bold\n    cell.className = "page-row";\n  }\n  // Append the row to the table body\n  table.appendChild(newRow);\n};\n\nconst rebuildTable = (table, documentData) => {\n  // Removing all existing rows from the table,\n  // either the placeholder or the previous results\n  while (table.firstChild) {\n    table.removeChild(table.firstChild);\n  }\n  documentData.forEach((pageData, index) => {\n    addRowToTable(table, [\n      `Page ${index + 1} (${pageData.dimensions.width} x ${\n        pageData.dimensions.height\n      })`,\n    ]);\n    // the for...in loop iterates over the keys of an object\n    for (const node in pageData.nodes) {\n      // for example,      ["Text", 1]\n      addRowToTable(table, [node, pageData.nodes[node]]);\n    }\n  });\n};\n\nexport { rebuildTable };\n')),(0,d.mdx)("p",null,"As follows, the ",(0,d.mdx)("inlineCode",{parentName:"p"},"rebuildTable()")," metacode."),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},"Initialize the existing table, which is the first argument it receives."),(0,d.mdx)("li",{parentName:"ul"},"Loop through each page in the ",(0,d.mdx)("inlineCode",{parentName:"li"},"documentData")," array, adding a row with the dimensions via ",(0,d.mdx)("inlineCode",{parentName:"li"},"addRowToTable()"),"; please note that, although the Table is supposed to have two columns, we can set a row with only one cell, which will span both of them."),(0,d.mdx)("li",{parentName:"ul"},"Loop through each node in the ",(0,d.mdx)("inlineCode",{parentName:"li"},"pageData.nodes")," object, adding a row with the node type and the number of instances found on that page."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("inlineCode",{parentName:"li"},"addRowToTable()")," is a utility function that takes a table and an array of strings as arguments. It creates a new ",(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table-row>"),", then loops through the array, creating a ",(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table-cell>")," for each string and appending it to the row. If the array contains only one element, the cell is given a ",(0,d.mdx)("inlineCode",{parentName:"li"},"page-row")," class, which makes it bold.")),(0,d.mdx)("p",null,(0,d.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,d.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"61.5625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,d.mdx)("picture",{parentName:"span"},"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/5530d/stats-addon-stats.webp 320w","/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/0c8fb/stats-addon-stats.webp 640w","/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/94b1e/stats-addon-stats.webp 1280w","/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/0b34d/stats-addon-stats.webp 1920w","/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/f3963/stats-addon-stats.webp 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,d.mdx)("source",{parentName:"picture",srcSet:["/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/dd4a7/stats-addon-stats.png 320w","/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/0f09e/stats-addon-stats.png 640w","/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/bbbf7/stats-addon-stats.png 1280w","/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/ac7a9/stats-addon-stats.png 1920w","/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/6482f/stats-addon-stats.png 2500w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,d.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/express-add-ons-docs/static/20c123041cdc33e0fc1d7d9bd0b60492/bbbf7/stats-addon-stats.png",alt:"stats addon stats",title:"stats addon stats",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,d.mdx)("h2",{id:"next-steps"},"Next Steps"),(0,d.mdx)("p",null,"Congratulations! You've coded from scratch the Stats add-on for Adobe Express. As an exercise, you may want to extend it with the following features."),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("strong",{parentName:"li"},"Better visualization"),": you can add ",(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-icon>")," elements for each Node type, or bypass the Table altogether using an Accordion component for a hierarchical, collapsible menu."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("strong",{parentName:"li"},"Hide and Show"),": via the ",(0,d.mdx)("a",{parentName:"li",href:"/express-add-ons-docs/references/document-sandbox"},"Document API")," you may hide and show elements based on their type—the ",(0,d.mdx)("inlineCode",{parentName:"li"},"<sp-table>")," has a ",(0,d.mdx)("inlineCode",{parentName:"li"},"selects")," and a ",(0,d.mdx)("inlineCode",{parentName:"li"},"selected")," attributes that you can put to use."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("strong",{parentName:"li"},"Save Snapshots"),": using the ",(0,d.mdx)("a",{parentName:"li",href:"/express-add-ons-docs/references/addonsdk/instance-clientStorage/"},"Client Storage API"),", you can keep track of the document's metadata and compare it with previous versions.")),(0,d.mdx)("h2",{id:"lessons-learned"},"Lessons Learned"),(0,d.mdx)("p",null,"Let's review the concepts covered in this tutorial and how they've been implemented in the Stats add-on."),(0,d.mdx)("ul",null,(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("strong",{parentName:"li"},"Communication API"),": the iframe and the Document Sandbox can expose and import each other's API via proxy objects. The Communication API wraps all inter-context function invocations with a Promise; hence, the need to ",(0,d.mdx)("inlineCode",{parentName:"li"},"await")," when invoking a proxy method."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("strong",{parentName:"li"},"Proxy API"),": the payload objects exchanged between the two contexts can contain functions, which are the most common use case: they can return primitives, object literals, JSON strings, ArrayBuffers, and Blobs."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("strong",{parentName:"li"},"Context Closures"),": proxy methods have access to variables defined in their context, even when invoked from the other context. This is a powerful feature that can be exploited to keep private variables and functions out of the Communication API."),(0,d.mdx)("li",{parentName:"ul"},(0,d.mdx)("strong",{parentName:"li"},"Roundtrip calls"),": proxy methods can be chained—the iframe can invoke the Document API via the Document Sandbox proxy, which in turn can invoke the iframe proxy, and so on.")),(0,d.mdx)("h2",{id:"final-project"},"Final Project"),(0,d.mdx)("p",null,"The code for this project can be downloaded ",(0,d.mdx)("a",{parentName:"p",href:"https://github.com/AdobeDocs/express-add-on-samples/tree/main/document-sandbox-samples/express-stats-addon"},"here"),". Use ",(0,d.mdx)("a",{parentName:"p",href:"https://github.com/AdobeDocs/express-add-on-samples/tree/main/document-sandbox-samples/express-addon-document-api-template"},"this template")," as a starting point."),(0,d.mdx)(c,{variant:"info",slots:"text1",mdxType:"InlineAlert"}),(0,d.mdx)("p",null,"Please use the UI iframe and Document Sandbox tabs to switch between the two domains and find a dropdown in the top-right corner to select which file to show."),(0,d.mdx)(l,{slots:"heading, code",repeat:"6",languages:"index.html, styles.css, ui/index.js, ui/table-utils.js, documentSandbox/code.js, documentSandbox/utils.js",mdxType:"CodeBlock"}),(0,d.mdx)("h4",{id:"ui-iframe-5"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <meta\n      name="description"\n      content="Adobe Express Add-on template using JavaScript, the Document Sandbox, and Webpack"\n    />\n    <meta\n      name="keywords"\n      content="Adobe, Express, Add-On, JavaScript, Document Sandbox, Adobe Express Document API"\n    />\n    <meta\n      name="viewport"\n      content="width=device-width, initial-scale=1.0"\n    />\n    <title>Stats add-ons</title>\n    <link\n      rel="stylesheet"\n      href="styles.css"\n    />\n  </head>\n\n  <body>\n    <sp-theme\n      scale="medium"\n      color="light"\n      theme="express"\n    >\n      <h3>Framework status</h3>\n      <hr />\n      <div class="row">\n        <sp-status-light\n          size="m"\n          variant="negative"\n          id="iframe-status"\n          >iFrame API</sp-status-light\n        >\n        <sp-status-light\n          size="m"\n          variant="negative"\n          id="document-status"\n          >Authoring API</sp-status-light\n        >\n      </div>\n      <h3>Document statistics</h3>\n      <hr />\n      <div class="row">\n        <sp-table size="m">\n          <sp-table-head>\n            <sp-table-head-cell>Element</sp-table-head-cell>\n            <sp-table-head-cell>Count</sp-table-head-cell>\n          </sp-table-head>\n          <sp-table-body id="stats-table-body">\n            <sp-table-row id="row-placeholder">\n              <sp-table-cell>Get the Document stats first...</sp-table-cell>\n            </sp-table-row>\n          </sp-table-body>\n        </sp-table>\n      </div>\n      <div class="row align-right">\n        <sp-button id="stats">Analyze document</sp-button>\n      </div>\n    </sp-theme>\n  </body>\n</html>\n')),(0,d.mdx)("h4",{id:"ui-iframe-6"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-css"},"body {\n  margin: 0;\n  padding: 0;\n  overflow-x: hidden;\n}\n\nsp-theme {\n  margin: 0 var(--spectrum-global-dimension-static-size-300);\n}\n\n.row {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  margin-bottom: var(--spectrum-global-dimension-static-size-175);\n}\n\n.align-right {\n  justify-content: flex-end;\n}\n\nsp-table {\n  width: 100%;\n}\n\nsp-button {\n  align-self: flex-end;\n}\n\n.page-row {\n  font-weight: var(--spectrum-global-font-weight-bold);\n}\n")),(0,d.mdx)("h4",{id:"ui-iframe-7"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import "@spectrum-web-components/styles/typography.css";\nimport "@spectrum-web-components/theme/src/themes.js";\nimport "@spectrum-web-components/theme/theme-light.js";\nimport "@spectrum-web-components/theme/express/theme-light.js";\nimport "@spectrum-web-components/theme/express/scale-medium.js";\nimport "@spectrum-web-components/theme/sp-theme.js";\n\nimport "@spectrum-web-components/status-light/sp-status-light.js";\nimport "@spectrum-web-components/table/elements.js";\nimport "@spectrum-web-components/button/sp-button.js";\n\nimport addOnUISdk from "https://express.adobe.com/static/add-on-sdk/sdk.js";\nimport { rebuildTable } from "./table-utils";\n\naddOnUISdk.ready.then(async () => {\n  const iframeApi = {\n    /**\n     * Toggles the status light.\n     * @param {string} sdk - The type of SDK that is ready, either "document" or "iframe"\n     */\n    toggleStatus(sdk) {\n      if (["document", "iframe"].indexOf(sdk) === -1) {\n        throw new Error("Invalid SDK type");\n      }\n      const el =\n        sdk === "document"\n          ? document.getElementById("document-status")\n          : document.getElementById("iframe-status");\n      el.setAttribute("variant", "positive");\n    },\n\n    createTable(documentData) {\n      const table = document.getElementById("stats-table-body");\n      rebuildTable(table, documentData);\n    },\n  };\n\n  // the addOnUISdk is ready, so we can now toggle the status light\n  iframeApi.toggleStatus("iframe");\n\n  // Get the Document Sandbox.\n  const { runtime } = addOnUISdk.instance;\n  // Importing the Document Sandbox API.\n  const sandboxProxy = await runtime.apiProxy("documentSandbox");\n  // Exposing the iframe API to the Document Sandbox.\n  runtime.exposeApi(iframeApi);\n\n  const statsButton = document.getElementById("stats");\n\n  statsButton.addEventListener("click", async () => {\n    await sandboxProxy.getDocumentData();\n  });\n  // Enabling the button only when the addOnUISdk is ready\n  statsButton.disabled = false;\n});\n\n/**\n * Adds a new row to the specified table.\n *\n * @param {HTMLTableElement} table - The table to which the row should be added.\n * @param {Array} rowData - An array containing the data for each cell in the row.\n */\nfunction addRowToTable(table, rowData) {\n  // Create a new row\n  const newRow = document.createElement("sp-table-row");\n\n  // For each cell data, create a cell and append it to the row\n  let cell;\n  rowData.forEach((cellData) => {\n    cell = document.createElement("sp-table-cell");\n    cell.textContent = cellData;\n    newRow.appendChild(cell);\n  });\n  if (rowData.length === 1) {\n    // Making the page row bold\n    cell.className = "page-row";\n  }\n  // Append the row to the table body\n  table.appendChild(newRow);\n}\n')),(0,d.mdx)("h4",{id:"ui-iframe-8"},"UI iframe"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'/**\n * Adds a new row to the specified table.\n *\n * @param {HTMLTableElement} table - The table to which the row should be added.\n * @param {Array} rowData - An array containing the data for each cell in the row.\n */\nconst addRowToTable = (table, rowData) => {\n  // Create a new row\n  const newRow = document.createElement("sp-table-row");\n\n  // For each cell data, create a cell and append it to the row\n  let cell;\n  rowData.forEach((cellData) => {\n    cell = document.createElement("sp-table-cell");\n    cell.textContent = cellData;\n    newRow.appendChild(cell);\n  });\n  if (rowData.length === 1) {\n    // Making the page row bold\n    cell.className = "page-row";\n  }\n  // Append the row to the table body\n  table.appendChild(newRow);\n};\n\nconst rebuildTable = (table, documentData) => {\n  // Removing all existing rows from the table\n  while (table.firstChild) {\n    table.removeChild(table.firstChild);\n  }\n\n  // The pageData comes as an array of objects, one for each page\n  // Each pageData object contains the dimensions of the page and the nodes, e.g.\n  // [{ dimensions: { width: 600, height: 800 }, nodes: { Text: 1, Rectangle: 4 } }, { ... }]\n  documentData.forEach((pageData, index) => {\n    addRowToTable(table, [\n      `Page ${index + 1} (${pageData.dimensions.width} x ${\n        pageData.dimensions.height\n      })`,\n    ]);\n    // the for...in loop iterates over the keys of an object\n    for (const node in pageData.nodes) {\n      // for example,      ["Text", 1]\n      addRowToTable(table, [node, pageData.nodes[node]]);\n    }\n  });\n};\n\nexport { rebuildTable };\n')),(0,d.mdx)("h4",{id:"document-sandbox-5"},"Document Sandbox"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnSandboxSdk from "add-on-sdk-document-sandbox";\nconst { runtime } = addOnSandboxSdk.instance;\n\nimport { editor } from "express-document-sdk";\nimport { getNodeData } from "./utils";\n\nasync function start() {\n  const panelUIProxy = await runtime.apiProxy("panel");\n\n  runtime.exposeApi({\n    async getDocumentData() {\n      const doc = editor.documentRoot;\n      let documentData = [];\n      for (const page of doc.pages) {\n        console.log("Page", page);\n        let pageData = {};\n        pageData.dimensions = {\n          width: page.width,\n          height: page.height,\n        };\n        pageData.nodes = getNodeData(page);\n        documentData.push(pageData);\n      }\n      console.log("documentData", documentData);\n      await panelUIProxy.createTable(documentData);\n    },\n  });\n\n  panelUIProxy.toggleStatus("document");\n}\n\nstart();\n')),(0,d.mdx)("h4",{id:"document-sandbox-6"},"Document Sandbox"),(0,d.mdx)("pre",null,(0,d.mdx)("code",{parentName:"pre",className:"language-js"},'const increaseCount = (obj, type) => {\n  // If the type is already in the object, increase its count, otherwise set it to 1\n  if (obj.hasOwnProperty(type)) {\n    obj[type] += 1;\n  } else {\n    obj[type] = 1;\n  }\n};\n\nconst getNodeData = (node, nodeData = {}) => {\n  if (node.type === "MediaContainer") {\n    return nodeData;\n  }\n\n  // Check if the current node has children and if they are not an empty array\n  if (node.allChildren && node.allChildren.length > 0) {\n    // Iterate over all children using for..of\n    for (const child of node.allChildren) {\n      // Increase the count for the current type\n      increaseCount(nodeData, child.type);\n\n      // Recursively call getNodeData for each child that has its own children\n      // ... unless it\'s a MediaContainer\n      if (\n        child.type !== "MediaContainer" &&\n        child.allChildren &&\n        child.allChildren.length > 0\n      ) {\n        getNodeData(child, nodeData);\n      }\n    }\n  }\n  return nodeData;\n};\n\nexport { getNodeData };\n')),(0,d.mdx)("div",{className:"footnotes"},(0,d.mdx)("hr",{parentName:"div"}),(0,d.mdx)("ol",{parentName:"div"},(0,d.mdx)("li",{parentName:"ol",id:"fn-0"},'When referring to "metadata", I mean the dimensions and types of elements on each page. Custom metadata haven\'t been implemented in Adobe Express yet.',(0,d.mdx)("a",{parentName:"li",href:"#fnref-0",className:"footnote-backref"},"↩")),(0,d.mdx)("li",{parentName:"ol",id:"fn-1"},"In my tests, the two SDKs are ready almost instantly and together—I couldn't tell which one is loaded firsts.",(0,d.mdx)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"↩")),(0,d.mdx)("li",{parentName:"ol",id:"fn-2"},"Designing data structures in the early stages of the development process is, in my humble opinion, a way to dodge a good deal of future headaches.",(0,d.mdx)("a",{parentName:"li",href:"#fnref-2",className:"footnote-backref"},"↩")),(0,d.mdx)("li",{parentName:"ol",id:"fn-3"},"A ",(0,d.mdx)("inlineCode",{parentName:"li"},'"MediaContainer"')," (say, an image) has as children both the ",(0,d.mdx)("inlineCode",{parentName:"li"},'"ImageRectangle"')," and the mask that crops it. At this stage of the Document API development, getting complex masks may throw an Error—hence, I've decided to use the ",(0,d.mdx)("inlineCode",{parentName:"li"},'"MediaContainer"')," type as a recursion's termination clause.",(0,d.mdx)("a",{parentName:"li",href:"#fnref-3",className:"footnote-backref"},"↩")))))}x.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-learn-how-to-tutorials-stats-addon-md-546597097516326d9a67.js.map
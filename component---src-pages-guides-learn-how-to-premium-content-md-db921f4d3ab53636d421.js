"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[1290],{27252:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return s},default:function(){return h}});var a=t(58168),o=t(80045),r=(t(88763),t(15680)),i=t(83407);const d=["components"],s={},m=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.mdx)("div",n)},p=m("InlineAlert"),c=m("CodeBlock"),l={_frontmatter:s},u=i.A;function h(e){let{components:n}=e,t=(0,o.A)(e,d);return(0,r.mdx)(u,(0,a.A)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"manage-premium-content"},"Manage Premium Content"),(0,r.mdx)("p",null,"When exporting Adobe Express documents, you should ensure proper handling of Premium content."),(0,r.mdx)("p",null,"Let's go through all the available options to manage the rendition of Premium content in case your add-on allows users to export or download it."),(0,r.mdx)("h2",{id:"show-a-premium-content-error-with-the-upgrade-option"},'Show a Premium Content error with the "Upgrade" option'),(0,r.mdx)("p",null,"One way to handle premium content is to display a warning message when the user is not entitled to export or download it, and include a button to allow them to upgrade. Please note that you can detect in advance if the user is entitled to Premium content (via ",(0,r.mdx)("a",{parentName:"p",href:"../../../references/addonsdk/app-currentUser.md#isPremiumUser"},(0,r.mdx)("inlineCode",{parentName:"a"},"isPremiumUser()")),"), and whether the page contains Premium content (via ",(0,r.mdx)("a",{parentName:"p",href:"/express-add-ons-docs/references/addonsdk/app-document.md#pagemetadata"},(0,r.mdx)("inlineCode",{parentName:"a"},"hasPremiumContent")),") in the first place. A try/catch block intercepting the ",(0,r.mdx)("inlineCode",{parentName:"p"},'"USER_NOT_ENTITLED_TO_PREMIUM_CONTENT"')," string in the error message as the primary way to deal with it is no longer recommended."),(0,r.mdx)("h3",{id:"example"},"Example"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnUISdk from "https://express.adobe.com/static/add-on-sdk/sdk.js";\nconst { app, constants } = addOnUISdk;\nconst { ButtonType, Range, RenditionFormat } = constants;\n\nconst showPremiumContentError = async () => {\n  // Show a modal dialog with an error message\n  const { buttonType } = await window.addOnUISdk.app.showModalDialog({\n    variant: "error",\n    title: "Export failed",\n    description:\n      "Sorry, we were not able to export your design. " +\n      "Some assets are only included in the Premium plan." +\n      "Try replacing with something else " +\n      "or upgrading Adobe Express to a Premium plan.",\n    buttonLabels: { secondary: "Upgrade" },\n  });\n\n  // The User is still not premium\n  if (buttonType === ButtonType.cancel) return false;\n  if (buttonType === ButtonType.secondary) {\n    // Original flow (don\'t use anymore)\n    // âŒ window.open(\n    //     "https://www.adobe.com/go/express_addons_pricing",\n    //     "_blank"\n    //   );\n    // ðŸ‘‡ Use startPremiumUpgradeIfFreeUser() instead\n    const hasUpgradedToPremium = await app.startPremiumUpgradeIfFreeUser();\n    return hasUpgradedToPremium;\n  }\n};\n\n// Check if the page range is safe to export\nconst isRangeSafeToExport = async (range) => {\n  const userIsPremium = await app.currentUser.isPremiumUser();\n  const pages = await app.document.getPagesMetadata({ range });\n  const containsPremiumContent = pages.some((page) => page.hasPremiumContent);\n  return (containsPremiumContent && userIsPremium) || !containsPremiumContent;\n};\n\nconst exportDocument = async () => {\n  // ðŸ‘‡ Testing purposes only! ðŸ‘‡\n  app.devFlags.simulateFreeUser = true; // ðŸ‘ˆ Remove in production!\n\n  let isSafeToExport = await isRangeSafeToExport(Range.entireDocument);\n  if (!isSafeToExport) {\n    const isNowPremiumUser = await showPremiumContentError();\n    isSafeToExport = isNowPremiumUser;\n  }\n\n  if (isSafeToExport) {\n    try {\n      const renditions = await app.document.createRenditions({\n        range: Range.entireDocument,\n        format: RenditionFormat.png,\n      });\n      renditions.forEach((rendition) => {\n        // do your thing w/ the renditions\n      });\n    } catch (err) {\n      // did someone just add premium content in the split second\n      // between our original check? did the user just downgrade?\n      if (err.message?.includes("USER_NOT_ENTITLED_TO_PREMIUM_CONTENT")) {\n        return await exportDocument(); // try again\n      }\n    }\n  }\n};\n\ndocument.querySelector("#export").onclick = exportDocument;\n')),(0,r.mdx)("p",null,"Please note that ",(0,r.mdx)("a",{parentName:"p",href:"../../../references/addonsdk/addonsdk-app.md#startpremiumupgradeiffreeuser"},(0,r.mdx)("inlineCode",{parentName:"a"},"startPremiumUpgradeIfFreeUser()"))," allows a more streamlined user experience for upgrading to premium content, compared to the older method of redirecting to the Adobe Express pricing page, which is now deprecated."),(0,r.mdx)("h2",{id:"provide-visual-cues-in-the-ui"},"Provide visual cues in the UI"),(0,r.mdx)("p",null,"Alternatively, you can provide visual cues directly in the add-on UI to show that users are not entitled to export/download premium content. This can be done in various ways, for instance, by disabling the export/download button, replacing it with an upgrade button, or appending a brief explanation, tooltip, or icon. This would inform users upfront that they are not entitled to export/download premium content, preventing them from facing the warning popup after attempting to do so."),(0,r.mdx)("h2",{id:"allow-only-the-preview-of-premium-content"},"Allow only the preview of Premium Content"),(0,r.mdx)("p",null,"As mentioned in ",(0,r.mdx)("a",{parentName:"p",href:"./create_renditions.md"},"Creating Renditions"),", you can allow users to preview Premium content within the iframe by setting the ",(0,r.mdx)("inlineCode",{parentName:"p"},"renditionIntent")," to the constant ",(0,r.mdx)("a",{parentName:"p",href:"../../../references/addonsdk/addonsdk-constants.md"},(0,r.mdx)("inlineCode",{parentName:"a"},"RenditionIntent.preview"))," as the second parameter of the ",(0,r.mdx)("a",{parentName:"p",href:"../../../references/addonsdk/app-document.md#createrenditions"},(0,r.mdx)("inlineCode",{parentName:"a"},"addOnUISdk.app.document.createRendition()"))," method. Remember to also add the ",(0,r.mdx)("a",{parentName:"p",href:"./create_renditions.md#the-preview-intent"},(0,r.mdx)("inlineCode",{parentName:"a"},'"renditionPreview"'))," permission to your add-on's ",(0,r.mdx)("inlineCode",{parentName:"p"},"manifest.json")," file."),(0,r.mdx)(p,{slots:"header, text, text1, text2",variant:"warning",mdxType:"InlineAlert"}),(0,r.mdx)("p",null,"Prevent previews download"),(0,r.mdx)("p",null,"Your add-on must not allow these previewed images to be downloaded or persisted on a backend (for any longer than necessary to serve the result back to the user). To that end, be sure that users cannot:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"right-click -> save as"),": To prevent this, reject the ",(0,r.mdx)("inlineCode",{parentName:"li"},"contextmenu")," event."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("strong",{parentName:"li"},"drag the image off the panel"),": To prevent this, you can reject the ",(0,r.mdx)("inlineCode",{parentName:"li"},"dragstart")," event.")),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Note:")," These behaviors are enabled by default if you use an ",(0,r.mdx)("inlineCode",{parentName:"p"},"<img>")," tag. If you apply the image using ",(0,r.mdx)("inlineCode",{parentName:"p"},"background-image")," CSS, these behaviors aren't added."),(0,r.mdx)("h3",{id:"example-1"},"Example"),(0,r.mdx)(c,{slots:"heading, code",repeat:"2",languages:"JavaScript, TypeScript",mdxType:"CodeBlock"}),(0,r.mdx)("h4",{id:"javascript"},"JavaScript"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-js"},'import addOnUISdk from "https://express.adobe.com/static/add-on-sdk/sdk.js";\n\n// Wait for the SDK to be ready\nawait addOnUISdk.ready;\n\n// Display preview of all pages in the AddOn UI\nasync function displayPreview() {\n  try {\n    const renditionOptions = {\n      range: addOnUISdk.constants.Range.entireDocument,\n      format: addOnUISdk.constants.RenditionFormat.png,\n      backgroundColor: 0x7faa77ff,\n    };\n    const renditions = await addOnUISdk.app.document.createRenditions(\n      renditionOptions,\n      addOnUISdk.constants.RenditionIntent.preview\n    );\n    renditions.forEach((rendition) => {\n      const image = document.createElement("img");\n      image.src = URL.createObjectURL(rendition.blob);\n      document.body.appendChild(image);\n    });\n  } catch (error) {\n    console.log("Failed to create renditions:", error);\n  }\n}\n')),(0,r.mdx)("h4",{id:"typescript"},"TypeScript"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-ts"},'import addOnUISdk from "https://express.adobe.com/static/add-on-sdk/sdk.js";\n\n// Wait for the SDK to be ready\nawait addOnUISdk.ready;\n\n// Display preview of all pages in the AddOn UI\nasync function displayPreview() {\n  try {\n    const renditionOptions: PngRenditionOptions = {\n      range: addOnUISdk.constants.Range.entireDocument,\n      format: addOnUISdk.constants.RenditionFormat.png,\n      backgroundColor: 0x7faa77ff,\n    };\n    const renditions = await addOnUISdk.app.document.createRenditions(\n      renditionOptions,\n      addOnUISdk.constants.RenditionIntent.preview\n    );\n    renditions.forEach((rendition) => {\n      const image = document.createElement("img");\n      image.src = URL.createObjectURL(rendition.blob);\n      document.body.appendChild(image);\n    });\n  } catch (error) {\n    console.log("Failed to create renditions:", error);\n  }\n}\n')))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-learn-how-to-premium-content-md-db921f4d3ab53636d421.js.map